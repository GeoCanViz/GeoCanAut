(function(){define(["jquery-private","knockout","gcaut-i18n","gcaut-func"],function(g,h,i,e){var b,d,c,f,a;b=function(l,m,k){var j=function(p,r,o){var n=this,q=o.length,s=e.getListCB(i.getDict("%legend-visibilitytypelist"));n.lblReset=i.getDict("%reset");n.lblRemove=i.getDict("%remove");n.lblEnable=i.getDict("%legend-enable");n.lblExpand=i.getDict("%expand");n.lblItemExpand=i.getDict("%legend-expand");n.lblLabel=i.getDict("%legend-label");n.lblMeta=i.getDict("%legend-metadata");n.lblMetaUrl=i.getDict("%legend-metaurl");n.lblMetaText=i.getDict("%legend-metatext");n.lblOpacity=i.getDict("%legend-opacity");n.lblOpacityMin=i.getDict("%minimum");n.lblOpacityMax=i.getDict("%maximum");n.lblVisibility=i.getDict("%legend-visibility");n.lblVisibilityState=i.getDict("%legend-visibilitystate");n.lblVisibilityType=i.getDict("%legend-visibilitytype");n.lblVisibilityRadio=i.getDict("%legend-visibilityradioid");n.lblDisplayChild=i.getDict("%legend-displaychild");n.lblCustomImage=i.getDict("%legend-customimage");n.lblCustomImageUrl=i.getDict("%legend-customimageurl");n.lblCustomImageText=i.getDict("%legend-customimagetext");n.tpRefresh=i.getDict("%projheader-tpnewmap");n.isEnable=h.observable(r.enable);n.isExpand=h.observable(r.expand);n.visibilityType=s;n.opacityValue=false;n.legendHolder=h.observableArray(r.items);n.legendLayers=h.observableArray(r.items);n.updateInitState=function(u,t){if(!u){t(true)}};n.updateCustom=function(u,t){if(u){t(false)}};n.updateOpacity=function(u,t){n.opacityValue=u;n.updateOpacityChild(t,u)};n.updateOpacityChild=function(t){h.utils.arrayForEach(t,function(u){if(n.opacityValue){u.opacity.enable(false);u.opacity.canenable(false)}else{u.opacity.canenable(true)}n.updateOpacityChild(u.items())})};c=function(z){var w=z.label,x=z.metadata,v=z.opacity,u=z.visibility,t=z.customimage,y=v.enable;z.expand=h.observable(z.expand);z.fullid=h.observable(z.fullid);z.last=h.observable(z.last);z.id=h.observable(z.id);z.displayfields=h.observable(z.displayfields),z.label.value=h.observable(w.value);z.label.alttext=h.observable(w.alttext);z.metadata.enable=h.observable(x.enable);z.metadata.value=h.observable(x.value);z.metadata.alttext=h.observable(x.alttext);z.opacity.enable=h.observable(v.enable);z.opacity.canenable=h.observable(n.opacityValue);z.opacity.min=h.observable(v.min).extend({numeric:2});z.opacity.max=h.observable(v.max).extend({numeric:2});z.visibility.enable=h.observable(u.enable);z.visibility.initstate=h.observable(u.initstate);z.visibility.type=h.observable(n.visibilityType[u.type-1]);z.visibility.radioid=h.observable(u.radioid).extend({numeric:0});z.displaychild=h.observable(z.displaychild);z.customimage.enable=h.observable(t.enable);z.customimage.url=h.observable(t.url);z.customimage.alttext=h.observable(t.alttext);z.items=h.observableArray(z.items);z.visibility.enable.subscribe(function(){n.updateInitState(z.visibility.enable(),z.visibility.initstate)});z.displaychild.subscribe(function(){n.updateCustom(z.displaychild(),z.customimage.enable)});z.opacity.enable.subscribe(function(){n.updateOpacity(z.opacity.enable(),z.items())});if(y){n.opacityValue=false}return z};n.createArray=function(t){h.utils.arrayForEach(t.items(),function(u){u=c(u);n.createArray(u)})};h.utils.arrayForEach(n.legendLayers(),function(t){n.opacityValue=true;t=c(t);n.createArray(t)});d(h,p);n.init=function(){return{controlsDescendantBindings:true}};n.bind=function(){setTimeout(function(){g(".legendSort").accordion("refresh");g(".legendSort").on("sortupdate",e.debounce(function(){n.removeEmpty()},1000,false))},1000);d(h,p);h.applyBindings(n,p)};n.reset=function(){var w,t,y,B,D,C=n.legendHolder(),A=[],z=h.observableArray(),x=C.length-1,v=0,u=0;while(v<=x){if(typeof C[v].id==="function"){t=C[v].id().replace(" / "," - ")}else{t=C[v].id.replace(" / "," - ")}y=t;A=t.split("/");B=A.length-1;u=0;D=(B===0)?true:false;w=n.unique(z,A[0],y,D);u++;while(u<=B){D=(u===B)?true:false;w=n.unique(w.items,A[u],y,D);u++}v++}n.legendLayers(z());g(".legendSort").accordion("refresh")};n.updateLayers=function(t){n.legendHolder(t)};n.unique=function(u,x,y,w){var v,t=u().length;while(t--){v=u()[t];if(v.id()===x){return v}}u.push(f(x,y,w));return u()[u().length-1]};f=function(v,w,u){var t;t={expand:h.observable(false),fullid:h.observable(w),last:h.observable(u),id:h.observable(v),displayfields:h.observable(false),label:{value:h.observable(v),alttext:h.observable(v)},metadata:{enable:h.observable(false),value:h.observable(),alttext:h.observable()},opacity:{enable:h.observable(false),canenable:h.observable(true),min:h.observable(0).extend({numeric:2}),max:h.observable(100).extend({numeric:2})},visibility:{enable:h.observable(true),initstate:h.observable(false),type:h.observable(n.visibilityType[0]),radioid:h.observable().extend({numeric:0})},displaychild:h.observable(true),customimage:{enable:h.observable(false),url:h.observable(),alttext:h.observable()},items:h.observableArray()};t.visibility.enable.subscribe(function(){n.updateInitState(t.visibility.enable(),t.visibility.initstate)});t.displaychild.subscribe(function(){n.updateCustom(t.displaychild(),t.customimage.enable)});t.opacity.enable.subscribe(function(){n.updateOpacity(t.opacity.enable(),t.items())});return t};n.removeLayer=function(x,y){var v,u,t=x.length-1,w=0;if(t===0){x[0].legendLayers.remove(y)}else{x[0].items.remove(y);while(w<t){u=x[w];if(w+1===t){v=x[w+1].legendLayers}else{v=x[w+1].items}n.existChild(u,v);w++}}g(".legendSort").accordion("refresh")};n.existChild=function(u,t){if(u.items().length===0){t.remove(u)}};n.removeEmpty=function(){};n.write=function(){var u,t;t=JSON.stringify(h.toJS(n.legendLayers)).replace(/{"id":/g,"").replace(/,"val":"radio"}/g,"").replace(/,"val":"case"}/g,"");t=t.replace(/,"canenable":false/g,"").replace(/,"canenable":true/g,"");u='"toolbarlegend": {"enable": '+n.isEnable()+',"expand": '+n.isExpand()+',"items": '+t+"}";return u};while(q--){o[q].value.subscribe(n[o[q].func],n)}n.init()};a=new j(l,m,k);h.applyBindings(a,l);return a};d=function(j,k){j.cleanNode(k)};return{initialize:b,clean:d}})}).call(this);